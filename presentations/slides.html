<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>MSW Slides</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reveal.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/theme/black.css" id="theme">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
  <style>
    .reveal .slides { text-align: left; }
    
    /* Enhanced controls */
    .controls-bar {
      position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 25px;
      display: flex; gap: 15px; align-items: center; z-index: 100;
      backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
    }
    
    .control-btn {
      background: rgba(255,255,255,0.1); border: none; color: white;
      padding: 8px 12px; border-radius: 15px; cursor: pointer;
      transition: all 0.2s ease; font-size: 14px;
    }
    
    .control-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
    .control-btn:disabled { opacity: 0.5; cursor: not-allowed; }
    
    .progress-info {
      color: white; font-size: 14px; font-weight: 500;
      background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 10px;
    }
    
    .toplink {
      position: fixed; top: 15px; right: 15px; z-index: 99;
      background: rgba(255,255,255,0.1); color: white; text-decoration: none;
      padding: 8px 12px; border-radius: 15px; backdrop-filter: blur(10px);
      transition: all 0.2s ease; border: 1px solid rgba(255,255,255,0.1);
    }
    
    .toplink:hover { background: rgba(255,255,255,0.2); transform: scale(1.05); }
    
    /* Keyboard shortcuts help */
    .shortcuts-help {
      position: fixed; top: 15px; left: 15px; z-index: 99;
      background: rgba(0,0,0,0.8); color: white; padding: 10px;
      border-radius: 10px; font-size: 12px; opacity: 0.7;
      transition: opacity 0.3s ease; max-width: 200px;
    }
    
    .shortcuts-help:hover { opacity: 1; }
    
    /* Progress bar */
    .progress-bar {
      position: fixed; top: 0; left: 0; width: 100%; height: 3px;
      background: rgba(255,255,255,0.1); z-index: 99;
    }
    
    .progress-fill {
      height: 100%; background: linear-gradient(90deg, #4aa3ff, #0066cc);
      width: 0%; transition: width 0.3s ease;
    }
    
    /* Enhanced slide styling */
    .reveal .slides section {
      background: rgba(255,255,255,0.02); border-radius: 10px;
      padding: 40px; margin: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    
    .reveal h1, .reveal h2, .reveal h3 {
      color: #4aa3ff; text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }
    
    .reveal pre code {
      background: rgba(0,0,0,0.5); border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.1);
    }
    
    /* Mobile responsive */
    @media (max-width: 768px) {
      .controls-bar { bottom: 10px; padding: 8px 15px; }
      .control-btn { padding: 6px 10px; font-size: 12px; }
      .shortcuts-help { display: none; }
      .reveal .slides section { padding: 20px; margin: 10px; }
    }
  </style>
</head>
<body>
  <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
  
  <div class="shortcuts-help">
    <strong>Shortcuts:</strong><br>
    ‚Üê ‚Üí : Navigate<br>
    Space: Next slide<br>
    F: Fullscreen<br>
    T: Theme toggle<br>
    Esc: Overview
  </div>
  
  <a class="toplink" href="#" onclick="window.close()">‚úñ Close</a>
  
  <div class="reveal">
    <div class="slides">
      <section id="md" data-markdown data-separator="^\n##\s+" data-separator-vertical="^\n###\s+" data-separator-notes="^Note:" data-charset="utf-8"></section>
    </div>
  </div>
  
  <div class="controls-bar">
    <button class="control-btn" id="prevBtn" onclick="Reveal.prev()">‚Üê Prev</button>
    <button class="control-btn" id="themeBtn" onclick="toggleTheme()">üåô Theme</button>
    <div class="progress-info" id="slideInfo">1 / 1</div>
    <button class="control-btn" id="fullscreenBtn" onclick="toggleFullscreen()">‚õ∂ Full</button>
    <button class="control-btn" id="nextBtn" onclick="Reveal.next()">Next ‚Üí</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/dist/reveal.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/markdown/markdown.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/reveal.js@5/plugin/highlight/highlight.js"></script>

  <script>
    const CONFIG = {
      owner: "cmpiyush", repo: "cmpiyush_lectures", branch: "main", rootPath: "",
    };
    const GH_RAW = (path) => `https://raw.githubusercontent.com/${CONFIG.owner}/${CONFIG.repo}/${encodeURIComponent(CONFIG.branch)}/${path}`;

    function getParam(name) {
      return new URL(location.href).searchParams.get(name);
    }

    let currentTheme = 'white';
    const themes = ['black', 'white', 'league', 'beige', 'sky', 'night', 'serif', 'simple'];

    function toggleTheme() {
      const idx = themes.indexOf(currentTheme);
      currentTheme = themes[(idx + 1) % themes.length];
      document.getElementById('theme').href = `https://cdn.jsdelivr.net/npm/reveal.js@5/dist/theme/${currentTheme}.css`;
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }

    function updateProgress() {
      const indices = Reveal.getIndices();
      const totalSlides = Reveal.getTotalSlides();
      const current = indices.h + 1;
      
      document.getElementById('slideInfo').textContent = `${current} / ${totalSlides}`;
      document.getElementById('progressFill').style.width = `${(current / totalSlides) * 100}%`;
      
      document.getElementById('prevBtn').disabled = current === 1;
      document.getElementById('nextBtn').disabled = current === totalSlides;
    }

    async function loadMarkdown() {
      let path = getParam("path");
      if (!path) {
        document.getElementById("md").innerHTML = "<h2>No note path provided.</h2>";
        return;
      }
      
      path = decodeURIComponent(path);
      const full = CONFIG.rootPath ? `${CONFIG.rootPath}/${path}` : path;

      try {
        const r = await fetch(GH_RAW(full));
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        
        let md = await r.text();
        const noteDir = path.split("/").slice(0, -1).join("/");
        
        md = md.replace(/!\[\[([^|\]]+?)(\|[^|\]]+)?\]\]/g, (m, target) => {
          const resolved = resolveRelative(noteDir, target.trim());
          const url = GH_RAW(CONFIG.rootPath ? `${CONFIG.rootPath}/${resolved}` : resolved);
          return `![](${url})`;
        });

        document.getElementById("md").textContent = md;
        
        await Reveal.initialize({
          hash: true,
          slideNumber: false,
          controls: false,
          progress: false,
          keyboard: {
            32: () => Reveal.next(), // Space
            70: toggleFullscreen,     // F
            84: toggleTheme,          // T
          },
          plugins: [RevealMarkdown, RevealHighlight]
        });
        
        Reveal.on('slidechanged', updateProgress);
        updateProgress();
        
      } catch (e) {
        document.getElementById("md").innerHTML = `<h2>Failed to load: ${e.message}</h2>`;
      }
    }

    function resolveRelative(baseDir, rel) {
      if (!baseDir) return rel;
      const base = baseDir.split("/").filter(Boolean);
      const parts = rel.split("/").filter(Boolean);
      const stack = [...base];
      for (const p of parts) {
        if (p === ".") continue;
        if (p === "..") stack.pop();
        else stack.push(p);
      }
      return stack.join("/");
    }

    loadMarkdown();
  </script>
</body>
</html>
